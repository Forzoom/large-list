!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("vue")):"function"==typeof define&&define.amd?define(["vue"],e):(t=t||self).LargeList=e(t.Vue)}(this,function(M){"use strict";function b(t){return null==t}M=M&&M.hasOwnProperty("default")?M.default:M;var e,h=(e="Object",function(t){return Object.prototype.toString.call(t)==="[object ".concat(e,"]")});function n(t,e,i){if(t>i[e[e.length-1]].top)return e.length-1;for(var n=0,a=e.length-1,r=Math.floor((n+a)/2);n+1<a;){var s=i[e[r]].top;if(s===t)return r;s<t?n=r:a=r,r=Math.floor((n+a)/2)}return r}return{name:"LargeList",props:{list:{type:Array,default:function(){return[]}},defaultItemHeight:{type:Number,default:200},defaultItemGap:{type:Number,default:10},preloadHeight:{type:Number,default:200},offsetTop:{type:Number,default:0},scrollEvent:{type:[String,Function],default:"scroll"},screenHeight:{type:Number},scrollY:{type:Number},persistence:{},load:{}},data:function(){return{metaMap:{},startIndex:0,endIndex:0,containerHeight:0,pendingRefresh:!1}},computed:{idList:function(){return this.list.map(function(t){return t.id})},displayList:function(){return this.list.slice(this.startIndex,this.endIndex)},screenHeight2:function(){return this.screenHeight||window.innerHeight},scrollY2:function(){return this.scrollY||window.scrollY}},watch:{"$props.list":function(t,e){var i=this.defaultItemHeight+this.defaultItemGap,n=this.containerHeight,a=!0,r=!1,s=void 0;try{for(var h,o=e[Symbol.iterator]();!(a=(h=o.next()).done);a=!0){var l=h.value;n-=this.metaMap[l.id].height}}catch(t){r=!0,s=t}finally{try{a||null==o.return||o.return()}finally{if(r)throw s}}for(var d=0,f=t.length;d<f;d++){var c=this.idList[d];if(b(this.metaMap[c])){var p=this.idList[d-1],u=0;this.metaMap[p]&&(u=this.metaMap[p].top+this.metaMap[p].height),M.set(this.metaMap,""+c,{top:u,height:i})}}var g=!0,m=!1,v=void 0;try{for(var y,x=t[Symbol.iterator]();!(g=(y=x.next()).done);g=!0){var H=y.value;n+=this.metaMap[H.id].height}}catch(t){m=!0,v=t}finally{try{g||null==x.return||x.return()}finally{if(m)throw v}}this.containerHeight=n;var I=this.$el;this.refresh(this.scrollY2-(I?I.offsetTop+this.offsetTop:0))},endIndex:function(t,e){if(this.pendingRefresh)for(var i=e,n=Math.min(e+8,this.idList.length);i<n;i++){var a=this.idList[i-1];if(!b(a)){var r=this.idList[i];this.metaMap[r].top=this.metaMap[a].top+this.metaMap[a].height}}}},methods:{scrollCallback:function(){var t=this.$el;this.refresh(this.scrollY2-(t?t.offsetTop+this.offsetTop:0))},refresh:function(t){var e=t+this.screenHeight2+this.preloadHeight;t-=this.preloadHeight;var i=this.idList;this.startIndex=t<0||0===i.length?0:n(t,i,this.metaMap),this.endIndex=e<0||0===i.length?0:n(e,i,this.metaMap)+1},onHeightChange:function(t,e){var i=this.metaMap[e].height,n=this.metaMap[e].height=t+this.defaultItemGap;this.containerHeight+=n-i;var a=!1,r=!0,s=!1,h=void 0;try{for(var o,l=this.displayList[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var d=o.value;d.id!==e?a&&(this.metaMap[d.id].top+=n-i):a=!0}}catch(t){s=!0,h=t}finally{try{r||null==l.return||l.return()}finally{if(s)throw h}}this.pendingRefresh=!0}},created:function(){var t=null;if(this.load&&(t=this.load()))this.metaMap=t.metaMap,this.containerHeight=t.containerHeight,this.startIndex=t.startIndex,this.endIndex=t.endIndex;else{for(var e=0,i=0,n=this.idList.length;i<n;i++){var a=""+this.idList[i],r=this.defaultItemHeight+this.defaultItemGap;M.set(this.metaMap,a,{top:i*r,height:r}),e+=r}this.containerHeight=e}this.scrollEvent&&window.addEventListener("scroll",this.scrollCallback)},mounted:function(){var t=this;this.$nextTick(function(){t.scrollCallback()})},beforeDestroy:function(){this.scrollEvent&&window.removeEventListener("scroll",this.scrollCallback),this.persistence&&this.persistence({metaMap:this.metaMap,startIndex:this.startIndex,endIndex:this.endIndex,containerHeight:this.containerHeight})},render:function(t){var s=this,e=this.$scopedSlots.default,i=e?e({startIndex:this.startIndex,endIndex:this.endIndex}):[];return(i||[]).forEach(function(t){var e=t.componentInstance,i=t.componentOptions;if(e?e._events.heightChange||e.$on("heightChange",s.onHeightChange):i?i.listeners?i.listeners.heightChange=s.onHeightChange:i.listeners={heightChange:s.onHeightChange}:t.data&&(t.data.on?t.data.on.heightChange=s.onHeightChange:t.data.on={heightChange:s.onHeightChange}),t.data){var n=t.data.style,a=t.componentOptions.propsData.id,r=s.metaMap[a].top+"px";n?"string"==typeof n?t.data.style=n+"; top: ".concat(r):h(n)&&(t.data.style.top=r,t.elm.style.top=r):t.data.style={top:r}}}),t("div",{class:"large-list",style:{height:this.containerHeight+"px"}},i)}}});
