!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):(e=e||self).LargeList=t(e.Vue)}(this,function(s){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function e(n,i,e,t,r){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,i,e)||e},o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,i,o),o=null),o}s=s&&s.hasOwnProperty("default")?s.default:s;var l="undefined"!=typeof Reflect&&Reflect.defineMetadata&&Reflect.getOwnMetadataKeys;function f(n,i,r){(r?Reflect.getOwnMetadataKeys(i,r):Reflect.getOwnMetadataKeys(i)).forEach(function(e){var t=r?Reflect.getOwnMetadata(e,i,r):Reflect.getOwnMetadata(e,i);r?Reflect.defineMetadata(e,t,n,r):Reflect.defineMetadata(e,t,n)})}var d={__proto__:[]}instanceof Array;function h(r){return function(e,t,n){var i="function"==typeof e?e:e.constructor;i.__decorators__||(i.__decorators__=[]),"number"!=typeof n&&(n=void 0),i.__decorators__.push(function(e){return r(e,t,n)})}}function y(e){"undefined"!=typeof console&&console.warn("[vue-class-component] "+e)}var g=["data","beforeCreate","created","beforeMount","mounted","beforeDestroy","destroyed","beforeUpdate","updated","activated","deactivated","render","errorCaptured","serverPrefetch"];function r(e,i){void 0===i&&(i={}),i.name=i.name||e._componentTag||e.name;var r=e.prototype;Object.getOwnPropertyNames(r).forEach(function(t){if("constructor"!==t)if(-1<g.indexOf(t))i[t]=r[t];else{var n=Object.getOwnPropertyDescriptor(r,t);void 0!==n.value?"function"==typeof n.value?(i.methods||(i.methods={}))[t]=n.value:(i.mixins||(i.mixins=[])).push({data:function(){var e;return(e={})[t]=n.value,e}}):(n.get||n.set)&&((i.computed||(i.computed={}))[t]={get:n.get,set:n.set})}}),(i.mixins||(i.mixins=[])).push({data:function(){return function(i,e){var t=e.prototype._init;e.prototype._init=function(){var e=this,t=Object.getOwnPropertyNames(i);if(i.$options.props)for(var n in i.$options.props)i.hasOwnProperty(n)||t.push(n);t.forEach(function(t){"_"!==t.charAt(0)&&Object.defineProperty(e,t,{get:function(){return i[t]},set:function(e){i[t]=e},configurable:!0})})};var n=new e;e.prototype._init=t;var r={};return Object.keys(n).forEach(function(e){void 0!==n[e]&&(r[e]=n[e])}),"production"!==process.env.NODE_ENV&&!(e.prototype instanceof s)&&0<Object.keys(r).length&&y("Component class must inherit Vue or its descendant class when class property is used."),r}(this,e)}});var t=e.__decorators__;t&&(t.forEach(function(e){return e(i)}),delete e.__decorators__);var n=Object.getPrototypeOf(e.prototype),o=n instanceof s?n.constructor:s,a=o.extend(i);return function(r,o,a){Object.getOwnPropertyNames(o).forEach(function(e){if(!b[e]){var t=Object.getOwnPropertyDescriptor(r,e);if(!t||t.configurable){var n=Object.getOwnPropertyDescriptor(o,e);if(!d){if("cid"===e)return;var i=Object.getOwnPropertyDescriptor(a,e);if(!function(e){var t=typeof e;return null==e||"object"!=t&&"function"!=t}(n.value)&&i&&i.value===n.value)return}"production"!==process.env.NODE_ENV&&0<=v.indexOf(e)&&y("Static property name '"+e+"' declared on class '"+o.name+"' conflicts with reserved property name of Vue internal. It may cause unexpected behavior of the component. Consider renaming the property."),Object.defineProperty(r,e,n)}}})}(a,e,o),l&&function(t,n){f(t,n),Object.getOwnPropertyNames(n.prototype).forEach(function(e){f(t.prototype,n.prototype,e)}),Object.getOwnPropertyNames(n).forEach(function(e){f(t,n,e)})}(a,e),a}var v=["cid","super","options","superOptions","extendOptions","sealedOptions","component","directive","filter"],b={prototype:!0,arguments:!0,callee:!0,caller:!0};function t(t){return"function"==typeof t?r(t):function(e){return r(e,t)}}t.registerHooks=function(e){g.push.apply(g,e)};var o="undefined"!=typeof Reflect&&void 0!==Reflect.getMetadata;function m(n){return void 0===n&&(n={}),function(e,t){!function(e,t,n){o&&(Array.isArray(e)||"function"==typeof e||void 0!==e.type||(e.type=Reflect.getMetadata("design:type",t,n)))}(n,e,t),h(function(e,t){(e.props||(e.props={}))[t]=n})(e,t)}}function O(i,e){void 0===e&&(e={});var t=e.deep,r=void 0!==t&&t,n=e.immediate,o=void 0!==n&&n;return h(function(e,t){"object"!=typeof e.watch&&(e.watch=Object.create(null));var n=e.watch;"object"!=typeof n[i]||Array.isArray(n[i])?void 0===n[i]&&(n[i]=[]):n[i]=[n[i]],n[i].push({handler:t,deep:r,immediate:o})})}var w,x,M,_,j,I,C,L,P,k,E,H,R,z,D,N,A=(w="Object",function(e){return Object.prototype.toString.call(e)==="[object ".concat(w,"]")});return x=t({name:"LargeList"}),M=m({type:Array,default:function(){return[]}}),_=m({type:Number,default:200}),j=m({type:Number,default:10}),I=m(),C=m(),L=O("$props.list"),P=O("endIndex"),x((H=e((E=function(){function o(){var e,t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return t=function(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?u(e):t}(this,(e=c(o)).call.apply(e,[this].concat(i))),p(u(t),"list",H,u(t)),p(u(t),"defaultItemHeight",R,u(t)),p(u(t),"defaultItemGap",z,u(t)),p(u(t),"persistence",D,u(t)),p(u(t),"load",N,u(t)),a(u(t),"topMap",{}),a(u(t),"metaMap",{}),a(u(t),"startIndex",0),a(u(t),"endIndex",0),a(u(t),"containerHeight",0),a(u(t),"pendingRefresh",!1),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}(o,s),function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(o,[{key:"onListChange",value:function(e){for(var t=this.defaultItemHeight+this.defaultItemGap,n=0,i=e.length;n<i;n++){var r=this.idList[n];if(null==this.topMap[r]){var o=this.idList[n-1];if(!o)continue;s.set(this.topMap,""+r,this.topMap[o]+this.metaMap[o].height),s.set(this.metaMap,""+r,{height:t}),this.containerHeight+=t}}}},{key:"onEndIndexChange",value:function(e,t){if(this.pendingRefresh)for(var n=t,i=Math.min(t+8,this.idList.length);n<i;n++){var r=this.idList[n-1];if(r){var o=this.idList[n];this.topMap[o]=this.topMap[r]+this.metaMap[r].height}}}},{key:"scrollCallback",value:function(){var e=this.$el;this.refresh(window.scrollY-(e?e.offsetTop:0))}},{key:"refresh",value:function(e){this.startIndex=e<0?0:this.binarySearch(e).index,this.endIndex=e+window.innerHeight<0?0:this.binarySearch(e+window.innerHeight).index+1}},{key:"binarySearch",value:function(e){var t=this.idList[this.idList.length-1];if(e>this.topMap[t])return{id:t,index:this.idList.length-1};for(var n=0,i=this.idList.length-1,r=Math.floor((n+i)/2);n+1<i;){var o=this.idList[r],a=this.topMap[o];if(a===e)return{id:o,index:r};a<e?n=r:i=r,r=Math.floor((n+i)/2)}return{id:this.idList[r],index:r}}},{key:"onHeightChange",value:function(e,t){var n=this.metaMap[t].height,i=this.metaMap[t].height=e+this.defaultItemGap;this.containerHeight+=i-n;var r=!1,o=!0,a=!1,s=void 0;try{for(var c,u=this.displayList[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var p=c.value;p.id!==t?r&&(this.topMap[p.id]+=i-n):r=!0}}catch(e){a=!0,s=e}finally{try{o||null==u.return||u.return()}finally{if(a)throw s}}this.pendingRefresh=!0}},{key:"created",value:function(){var e=null;if(this.load&&(e=this.load()))this.topMap=e.topMap,this.metaMap=e.metaMap,this.containerHeight=e.containerHeight,this.startIndex=e.startIndex,this.endIndex=e.endIndex;else{for(var t=0,n=0,i=this.idList.length;n<i;n++){var r=""+this.idList[n],o=this.defaultItemHeight+this.defaultItemGap;s.set(this.topMap,r,n*o),s.set(this.metaMap,r,{height:o}),t+=o}this.containerHeight=t}window.addEventListener("scroll",this.scrollCallback)}},{key:"mounted",value:function(){var e=this;this.$nextTick(function(){e.scrollCallback()})}},{key:"beforeDestroy",value:function(){window.removeEventListener("scroll",this.scrollCallback),this.persistence&&this.persistence({topMap:this.topMap,metaMap:this.metaMap,startIndex:this.startIndex,endIndex:this.endIndex,containerHeight:this.containerHeight})}},{key:"render",value:function(e){var a=this,t=this.$scopedSlots.default,n=t?t({startIndex:this.startIndex,endIndex:this.endIndex}):[];return(n||[]).forEach(function(e){var t=e.componentInstance,n=e.componentOptions;if(t&&!t._events.heightChange?t.$on("heightChange",a.onHeightChange):n?n.listeners?n.listeners.heightChange=a.onHeightChange:n.listeners={heightChange:a.onHeightChange}:t||e.data&&(e.data.on?e.data.on.heightChange=a.onHeightChange:e.data.on={heightChange:a.onHeightChange}),e.data){var i=e.data.style,r=e.componentOptions.propsData.id,o=a.topMap[r]+"px";i?"string"==typeof i?e.data.style=i+"; top: ".concat(o):A(i)&&(e.data.style.top=o):e.data.style={top:o}}}),e("div",{class:"large-list",style:{height:this.containerHeight+"px"}},n)}},{key:"idList",get:function(){return this.list.map(function(e){return e.id})}},{key:"displayList",get:function(){return this.list.slice(this.startIndex,this.endIndex)}}]),o}()).prototype,"list",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R=e(E.prototype,"defaultItemHeight",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=e(E.prototype,"defaultItemGap",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=e(E.prototype,"persistence",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N=e(E.prototype,"load",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e(E.prototype,"onListChange",[L],Object.getOwnPropertyDescriptor(E.prototype,"onListChange"),E.prototype),e(E.prototype,"onEndIndexChange",[P],Object.getOwnPropertyDescriptor(E.prototype,"onEndIndexChange"),E.prototype),k=E))||k});
